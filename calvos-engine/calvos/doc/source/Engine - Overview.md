

[TOC]

# Calvos Engine

Calvos Engine is in charge of generating C-source code corresponding to a set of features and items defined by an user in a project. This engine is composed of the following elements:

- Calvos components: building blocks for generation of code within the engine. A component is intended to encapsulate a given set of features to which source code will be generated for. E.g., a component can encapsulate serial communications artifacts, another one can model the generation of SW timers, etc. 
- Calvos Project: a definition of a user project including which components are to be used.
- Project parser: processes a user's calvos project invoking the necessary components to generate their output source code.
- Engine-level parameters: an infrastructure for providing configurations about the engine behaviors.
- Documenting system

## Calvos Components

The components are the building blocks within the calvos engine. A component has the following elements:

- *(Required)* **Name**: a unique name for the component. Its expected to be a short name or an acronym representing the component intention and compliant with C-identifier syntax except by not starting with "_".

  E.g., "aComponent"

- *(Required)* **Body**: a python module implementing the component. This python module has the same name as the component's name. 

  E.g., aComponent.py

- *(Required)* A **component descriptor file** (CDF): An XML file describing the component. This CFD also has the same name as the component's name and shall be compliant with the schema "_component_defs.xsd".

  E.g., aComponent.xml

  This file contains, among others, the following information about the component:

  - Name
  - Description
  - Allowed component's multiplicity within a project
  - List of associated User Input Templates (UIT)
  - List of associated Source File Templates (SFT)
  - Definition of component-level configurable parameters

- *(Optional)* Set of **user input templates**: Templates for the user to define the elements to be generated by the component, configure their behaviors, etc. These templates are a set of LibreOffice ODS files or XML files.

- *(Required)* **Source Tree Descriptor**: models the quantity and dependencies among the Source File Templates of the component.  

- *(Optional)* Set of **C source files templates**: Templates used for the generation of C source code for the component. These templates are .c and/or .h files containing the information to generate the source code. This is achieved by interleaving static C-code with python code ready to be parsed with the "cogapp" python module.

- *(Optional)* Set of **documents** for the component.

The calvos components have the following files structure:

FFFFFF TBD

### Components Container

Multiple components can be contained inside a folder known as "components container". This concept allows the organization of related components into a single container so that the overall file structure doesn't blow-up.

A container has the following files structure:

FFFFFF TBD2

### Component-Level Parameters

### User Input Template (UIT)

Every component can have none, one or multiple user input templates. These UIT are intended to capture the user-defined items that will be generated for given component. A user input template structure is organized as follows (mimicking a book):

- **UIT Cover Page**: contains general information about the UIT itself, like its name, description, version, etc.
- **User Cover Page**: intended to be used by the final user to place information about the user-specific project to which the current UIT belongs to.
- **Body Pages**: set of "pages" each modeling a category of generating items for the component.
- **Generating Items**: an item defined by the user that will typically represent an artifact in the generated code. For example, in a component implementing a communication protocol, an item can be a signal, a message, a data type, etc.
- **Configuration Pages**: set of "pages" presenting the component-level configurable parameters so that the user can customize aspects of the component.

### Source File Template (SFT)

Describe a C-source (.c) or a Header file (.h) that will be generated for the component. This template contains:

- (required)  logical name: name of the source file being modeled by the SFT. This name is NOT the name of the generated output file but, rather, it is an "internal" name to be used within the engine. Each SFT needs to have a unique name within a given component.
- (required) type: type of source file. It can be either "source" or "header".
- (optional) includes: list of files to be included by this SFT. Reference to files will be done by using the SFT name with a dot notation of their location. 



## Calvos Project

A **calvos project** is the entry point for the processing of a user project.

A calvos project has the following elements:

- A project description file: an XML file compliant with the schema "_calvos_project.xsd".

  E.g., "A calvos project.xml"

- A set of user input files

The **project description file** contains the following elements: 

- Project Name: user defined name.
- Project information: user defined data like description, version, date, etc.
- Set of components: the user specifies which calvos components to use for the project. For each component the user needs to indicate which user input files to use and their locations.
- Project-specific values for engine-level parameters.

**User input files**:

- A set of ODS or XML files with the user's definitions for the elements to generate for each component used in the project.
- The user input files need to follow the user input template(s) defined for each component used in the project. 

Suggested project file structure:

FFFFFFF TBD3

The user can freely define a different structure as long as the exact location of each referenced user input file is provided in the project description file. 

### Project Logical Structure

### Project Processing

The project parser takes the project description file and invokes each of the referenced components. Each invoked component will parse the required user input files and generate the corresponding c-source code.

The default file structure of a processed calvos project looks as follows:

FFFFFF TBD4

The location where to place the generated source code, documentation, translated templates, etc. is customizable by the user by project-level parameters.

During the processing of the project, the calvos engine generates a log file with messages thrown during such processing. It is important that the user analyze the contents of the log file to identify possible warnings or errors that could've occurred during the generation of the source-code. The verbosity level of this log file can be determined during the calvos engine invocation by command line arguments. 

## Project Parser

This part of the engine is in charge of processing the user's project and trigger each required component to finally generate the output source-code.



## Engine-Level Paramaters

## Documentation System

